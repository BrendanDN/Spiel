<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="The Just Chatting Twitch alternative live streaming service">
    <title>Spiel-Watch</title>
     <meta property="og:title" content="Spiel - Live Streaming" />
    <meta property="og:description" content="The Just Chatting Twitch Youtube Live alternative live streaming service" />
    <meta property="og:image" content="" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunViewer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/mediabuffer.js"></script>
  </head>
  <body>
    <h-d></h-d>
    <main>
      <div class="center">
        <div class="container">
          <pre style="font-size: clamp(1rem, 2vw, 2.5rem)">Emotes: </pre>
          <p id="chat"></p>
          <div aria-label='emote buttons'>
            <ul class="container">
              <li><button onclick="emotes('👋')">👋 Hi</button></li>
              <li><button onclick="emotes('🤣')">🤣 LUL</button></li>
              <li><button onclick="emotes('😞')">😞 L</button></li>
              <li><button onclick="emotes('😨')">😨 what</button></li>
              <li><button onclick="emotes('👍')">👍 good</button></li>
              <li><button onclick="emotes('😴')">😴 Zzz</button></li>
              <li><button onclick="emotes('🤟')">🤟 Luv U</button></li>
              <li><button onclick="emotes('🔥')">🔥 FIRE</button></li>
            </ul>
          </div>
          <video id="video" autoplay controls/>
        </div>
        <hr>
        <div class="center">
          <button onclick="document.getElementById('shareDialog').showModal()">Share Creator</button>
          <button onclick="document.getElementById('reportDialog').showModal()">Report</button>
        </div>
        <dialog id="shareDialog">
          <div id="modal" class="center">
            <div class="center">
              <ul>
                <li><a id="facebook" href="" target="_blank">Facebook</a></li>
                <li><a id="whatsapp" href="" target="_blank">WhatsApp</a></li>
                <li><a id="weibo" href="">Weibo</a></li>
                <li><a id="twitter" href="">Twitter</a></li>
                <li><a id="reddit" href="">Reddit</a></li>
              </ul>
            </div>
            <div class="center">
              <button onclick="document.getElementById('shareDialog').close()">Close</button>
            </div>
          </div>
        </dialog>
        <dialog id="reportDialog">
          <div id="modal" class="center">
            <p>Are You Sure You Want To Report This Streamer!</p>
            <div class="center">
              <button onclick="gunDB.get('stream-meta').get('meta').get(streamer).put(null); window.location.search = 'content=home';">Confirm</button>
              <button onclick="document.getElementById('reportDialog').close()">Close</button>
            </div>
          </div>
        </dialog>
        <script src="js/stores.js"></script>
        <script src="js/components.js" defer></script>
        <script>
          const url = new URL(window.location);
          const streamer = url.searchParams.get('search');
          let chat = []
          
          //Basic configurations for mime types
          const MIMETYPE_VIDEO_AUDIO = 'video/webm; codecs="vp8,opus"';
          const MIMETYPE_VIDEO_ONLY = 'video/webm; codecs="vp8"';

          document.getElementById("facebook").href = String("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(url));
          document.getElementById("whatsapp").href = String("https://api.whatsapp.com/send?text=" + encodeURIComponent(url));
          document.getElementById("weibo").href = String("http://service.weibo.com/share/share.php?url=" + encodeURIComponent(url) + "&appkey=&title=&pic=&ralateUid=&language=zh_cn");
          document.getElementById("twitter").href = String("https://twitter.com/intent/tweet?url=" + encodeURIComponent(url));
          document.getElementById("reddit").href = String("https://www.reddit.com/submit?url=" + encodeURIComponent(url));

          //Configure GunViewer 
          var viewer_config = {
            mimeType: MIMETYPE_VIDEO_AUDIO,
            streamerId: "video",//ID of the streamer
            debug: false,//For debug logs  
          }

          var gunViewer = new GunViewer(viewer_config);

          //Get data from gun and pass along to viewer
          gunDB.get(streamer).on(function (data) {
            //Make sure the video is in the html or create on here dynamically.
            gunViewer.onStreamerData(data);
          });

          function emotes(emoji){
            if (user.is){
              gunDB.get(streamer + '-chat').get('chat').get(user.is.pub).put(emoji);
            } else {
              window.location.search = 'content=signin';
            }
          }

          gunDB.get(streamer + '-chat').get('chat').map().on(function (data) {
            if (chat.length >= 7) {
              chat.shift();
            }
            chat.push(data);
            document.getElementById('chat').innerHTML = chat.join("");
          });
        </script>
      </div>
    </main>
    <f-t></f-t>
  </body>
</html>
