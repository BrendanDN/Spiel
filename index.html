<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="The Just Chatting Twitch and Youtube Live alternative live streaming service">
    <title>Spiel</title>
    <meta property="og:title" content="Spiel" />
    <meta property="og:description" content="The Just Chatting Twitch Youtube Live alternative live streaming service" />
    <meta property="og:image" content="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAUA
    AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
        9TXL0Y4OHwAAAABJRU5ErkJggg==" />
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="./app.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunRecorder.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunStreamer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunViewer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/mediabuffer.js"></script>
  </head>
  <body id="app">
    <header>
      <div>
        <h1>Spiel</h1>
      </div>
      <div>
        <nav>
          <div>
            <ul>
              <li><button onclick="insertParam('content', 'home')">Home</button></li>
              <li><button onclick="insertParam('content', 'live')">Live</button></li>
              <li><button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel/blob/main/README.md#guides'">Guides</button></li>
              <li><button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel/blob/main/README.md#support'">Support</button></li>
            </ul>
          </div>
          <hr>
          <div id="auth"></div>
        </nav>
      </div>
    </header>
    <script>
      //Configure GUN to pass to streamer
      const gun = Gun();
      let user = gun.user().recall({sessionStorage: true});

      const urlParams = new URLSearchParams(window.location.search);
      const content = urlParams.get('content');

      function insertParam(key, value) {
        key = encodeURIComponent(key);
        value = encodeURIComponent(value);

        // kvp looks like ['key1=value1', 'key2=value2', ...]
        var kvp = document.location.search.substr(1).split('&');
        let i=0;

        for(; i<kvp.length; i++){
          if (kvp[i].startsWith(key + '=')) {
            let pair = kvp[i].split('=');
            pair[1] = value;
            kvp[i] = pair.join('=');
            break;
          }
        }

        if(i >= kvp.length){
          kvp[kvp.length] = [key,value].join('=');
        }

        // can return this or...
        let params = kvp.join('&');

        // reload page with new params
        document.location.search = params;
      }

      if (!urlParams.has('content')) {
        insertParam('content', 'home');
      } 
      
      function signout() {
        try {
          user.leave();
          location.reload();
        } catch(err) {
          alert(err);
        }
      }
      
      if (user.is) {
        document.getElementById("auth").innerHTML = `
          <ul>
            <li><button onclick="signout()">Sign Out</button></li>
          </ul>
        `;

        switch(content) {
        case 'watch':
          document.write(watch);
          break;
        case 'auth':
          document.write(home);
          break;
        case 'live':
          document.write(live);
          break;
        case 'home':
          document.write(home);
          break;
        default:
          document.write(err404)
        }
      } else {
        document.getElementById("auth").innerHTML = `
          <ul>
            <li><button onclick="insertParam('content', 'auth')">Sign In</button></li>
            <li><button onclick="insertParam('content', 'auth')">Sign Up</button></li>
          </ul>
        `;

        switch(content) {
        case 'watch':
          document.write(watch);
          break;
        case 'auth':
          document.write(auth);
          break;
        case 'live':
          document.write(auth);
          break;
        case 'home':
          document.write(home);
          break;
        default:
          document.write(err404)
        }
      }
    </script>
    <footer>
      <pre><b>Spiel</b></pre>
      <button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel/blob/main/README.md#support-us'">Donate</button>
    </footer>
  </body>
</html>
