<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="The Just Chatting Twitch and Youtube Live alternative live streaming service">
    <title>Spiel - Live Streaming</title>
    <meta property="og:title" content="Spiel - Live Streaming" />
    <meta property="og:description" content="The Just Chatting Twitch Youtube Live alternative live streaming service" />
    <meta property="og:image" content="" />
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="./app.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunRecorder.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunStreamer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/GunViewer.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/QVDev/GunStreamer@0.0.9/js/mediabuffer.js"></script>
  </head>
  <body id="app">
    <header>
      <div class="center">
        <h1>Spiel</h1>
      </div>
      <div class="center">
        <nav>
          <div>
            <ul>
              <li><button onclick="window.location.search = 'content=home'">Home</button></li>
              <li><button onclick="window.location.search = 'content=live'">Live</button></li>
              <li><button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel#guides'">Guides</button></li>
              <li><button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel#support'">Support</button></li>
            </ul>
          </div>
          <hr>
          <div id="auth"></div>
        </nav>
      </div>
    </header>
    <script>
      const pagesSignedIn = {
        'watch': watch,
        'signin': home,
        'signup': home,
        'live': live,
        'home': home
      }

      const pagesSignedOut = {
        'watch': watch,
        'signin': auth,
        'signup': auth,
        'live': auth,
        'home': home
      }

      //Configure GUN to pass to streamer
      const peers = ['https://spiel-server-eu.herokuapp.com/gun', 'https://spiel-server-us.herokuapp.com/gun'];
      const opt = { peers: peers, localStorage: false, radisk: false };
      const gunDB = Gun(opt);
      
      //Configure GUN to pass to streamer
      const gun = Gun();
      const user = gun.user().recall({sessionStorage: true});

      const urlParams = new URLSearchParams(window.location.search);
      const content = urlParams.get('content');
      
      function signout() {
        try {
          user.leave();
          location.reload();
        } catch(err) {
          alert(err);
        }
      }

      if (!urlParams.has('content')) {
        window.location.search = 'content=home';
      }

      switch(user.is) {
        case undefined:
          document.getElementById("auth").innerHTML = `
            <ul>
              <li><button onclick="window.location.search = 'content=signin'">Sign In</button></li>
              <li><button onclick="window.location.search = 'content=signup'">Sign Up</button></li>
            </ul>
          `;
          
          if (pagesSignedOut[content] !== undefined) {
            document.write(pagesSignedOut[content]);
          } else {
            document.write(err404);
          }
          break;
        default:
          document.getElementById("auth").innerHTML = `
            <ul>
              <li><button onclick="signout()">Sign Out</button></li>
            </ul>
          `;

          if (pagesSignedIn[content] !== undefined) {
            document.write(pagesSignedIn[content]);
          } else {
            document.write(err404);
          }
          break;
      }
    </script>
    <footer>
      <pre><b>Spiel</b></pre>
      <button onclick="window.location.href = 'https://github.com/BrendanDN/Spiel#support-us'">Donate</button> 
    </footer>
  </body>
</html>
